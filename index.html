<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>To‑Do List</title>
  <style>
    :root{
      --bg:#0f172a; /* slate-900 */
      --panel:#111827; /* gray-900 */
      --panel-2:#1f2937; /* gray-800 */
      --text:#e5e7eb; /* gray-200 */
      --muted:#9ca3af; /* gray-400 */
      --accent:#22c55e; /* green-500 */
      --danger:#ef4444; /* red-500 */
      --focus:#60a5fa; /* blue-400 */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:linear-gradient(180deg,#0b1022,#0f172a);color:var(--text);}
    .container{max-width:720px;margin:48px auto;padding:16px}
    .card{background:rgba(17,24,39,.8);backdrop-filter:blur(8px);border:1px solid #1f2937;border-radius:16px;box-shadow:0 10px 25px rgba(0,0,0,.35)}
    header{display:flex;align-items:center;justify-content:space-between;padding:20px 20px 12px}
    h1{font-size:24px;margin:0;letter-spacing:.5px}
    .count{font-size:12px;color:var(--muted)}
    .input-row{display:flex;gap:8px;padding:0 20px 16px}
    input[type="text"]{flex:1;padding:12px 14px;border-radius:10px;border:1px solid #334155;background:var(--panel-2);color:var(--text)}
    input[type="text"]:focus{outline:2px solid var(--focus);border-color:transparent}
    button{cursor:pointer;border:0;border-radius:10px;padding:10px 14px;background:var(--accent);color:#052e16;font-weight:600}
    button.secondary{background:#334155;color:#e2e8f0}
    button.ghost{background:transparent;border:1px solid #334155;color:#e2e8f0}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;padding:0 20px 16px}
    .filters{display:flex;gap:6px}
    .filters button[aria-pressed="true"]{outline:2px solid var(--focus);}
    ul{list-style:none;margin:0;padding:0}
    li.todo{display:grid;grid-template-columns:auto 1fr auto;gap:10px;align-items:center;padding:12px 20px;border-top:1px solid #1f2937}
    li.todo:last-child{border-bottom-left-radius:16px;border-bottom-right-radius:16px}
    .todo input[type="checkbox"]{width:18px;height:18px}
    .title{line-height:1.4;word-break:break-word}
    .title.completed{color:#6b7280;text-decoration:line-through}
    .actions{display:flex;gap:6px}
    .empty{padding:24px 20px;color:var(--muted)}
    .sr-only{position:absolute !important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap}
  </style>
</head>
<body>
  <div class="container">
    <div class="card" role="region" aria-label="To‑Do 앱">
      <header>
        <h1>To‑Do List</h1>
        <div class="count" id="count">0개 남음</div>
      </header>

      <div class="input-row">
        <label class="sr-only" for="newTodo">할 일 추가</label>
        <input id="newTodo" type="text" placeholder="할 일을 입력하고 Enter 또는 ‘추가’ 클릭" autocomplete="off" />
        <button id="addBtn" aria-label="할 일 추가">추가</button>
      </div>

      <div class="toolbar">
        <div class="filters" role="tablist" aria-label="보기 필터">
          <button class="secondary" data-filter="all" aria-pressed="true">전체</button>
          <button class="secondary" data-filter="active" aria-pressed="false">미완료</button>
          <button class="secondary" data-filter="completed" aria-pressed="false">완료</button>
        </div>
        <div style="flex:1"></div>
        <button id="clearCompleted" class="ghost" title="완료 항목 모두 삭제">완료 삭제</button>
      </div>

      <ul id="list" aria-live="polite"></ul>
    </div>
  </div>

  <template id="todoItem">
    <li class="todo">
      <input type="checkbox" aria-label="완료 표시" />
      <div class="title" contenteditable="false"></div>
      <div class="actions">
        <button class="secondary edit" title="편집">편집</button>
        <button class="ghost remove" title="삭제" aria-label="삭제">삭제</button>
      </div>
    </li>
  </template>

  <script>
    const STORAGE_KEY = 'vanilla_todo_v1';

    const $ = (sel, el=document) => el.querySelector(sel);
    const $$ = (sel, el=document) => Array.from(el.querySelectorAll(sel));

    const state = {
      todos: load(),
      filter: 'all'
    };

    const newTodo = $('#newTodo');
    const addBtn = $('#addBtn');
    const list = $('#list');
    const count = $('#count');
    const clearCompletedBtn = $('#clearCompleted');

    function save(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state.todos));
    }
    function load(){
      try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)) ?? []; }
      catch{ return []; }
    }

    function uid(){ return Math.random().toString(36).slice(2,10); }

    function addTodo(title){
      title = title.trim();
      if(!title) return;
      state.todos.push({ id: uid(), title, completed:false, createdAt: Date.now() });
      save();
      render();
    }

    function toggle(id){
      const t = state.todos.find(t=>t.id===id);
      if(!t) return;
      t.completed = !t.completed;
      save();
      render();
    }

    function remove(id){
      state.todos = state.todos.filter(t=>t.id!==id);
      save();
      render();
    }

    function edit(id, newTitle){
      const t = state.todos.find(t=>t.id===id);
      if(!t) return;
      t.title = newTitle.trim() || t.title; // 빈 편집은 무시
      save();
      render();
    }

    function clearCompleted(){
      state.todos = state.todos.filter(t=>!t.completed);
      save();
      render();
    }

    function setFilter(f){
      state.filter = f;
      $$('.filters button').forEach(b=>b.setAttribute('aria-pressed', String(b.dataset.filter===f)));
      render();
    }

    function filtered(){
      if(state.filter==='active') return state.todos.filter(t=>!t.completed);
      if(state.filter==='completed') return state.todos.filter(t=>t.completed);
      return state.todos;
    }

    function render(){
      list.innerHTML='';
      const items = filtered();
      if(items.length===0){
        list.innerHTML = `<li class="empty">${state.filter==='completed'?'완료된 항목이 없습니다.':'할 일을 추가해 보세요 ✨'}</li>`;
      } else {
        for(const t of items){
          const tpl = document.importNode($('#todoItem').content, true);
          const li = tpl.querySelector('li');
          const checkbox = tpl.querySelector('input[type="checkbox"]');
          const title = tpl.querySelector('.title');
          const editBtn = tpl.querySelector('.edit');
          const removeBtn = tpl.querySelector('.remove');

          li.dataset.id = t.id;
          checkbox.checked = t.completed;
          title.textContent = t.title;
          title.classList.toggle('completed', t.completed);

          checkbox.addEventListener('change', ()=> toggle(t.id));
          removeBtn.addEventListener('click', ()=> remove(t.id));

          // 편집 토글
          editBtn.addEventListener('click', ()=>{
            const editing = title.getAttribute('contenteditable') === 'true';
            if(!editing){
              title.setAttribute('contenteditable','true');
              title.focus();
              placeCaretAtEnd(title);
              editBtn.textContent='저장';
            } else {
              title.setAttribute('contenteditable','false');
              editBtn.textContent='편집';
              edit(t.id, title.textContent);
            }
          });

          // Enter로 저장, Esc로 취소
          title.addEventListener('keydown', (e)=>{
            if(e.key==='Enter'){
              e.preventDefault();
              title.blur();
              editBtn.click();
            } else if(e.key==='Escape'){
              e.preventDefault();
              title.textContent = t.title;
              title.setAttribute('contenteditable','false');
              editBtn.textContent='편집';
            }
          });

          list.appendChild(tpl);
        }
      }
      const remaining = state.todos.filter(t=>!t.completed).length;
      count.textContent = `${remaining}개 남음`;
    }

    function placeCaretAtEnd(el){
      const range = document.createRange();
      const sel = window.getSelection();
      range.selectNodeContents(el);
      range.collapse(false);
      sel.removeAllRanges();
      sel.addRange(range);
    }

    // 이벤트 바인딩
    addBtn.addEventListener('click', ()=> addTodo(newTodo.value));
    newTodo.addEventListener('keydown', (e)=>{
      if(e.key==='Enter'){
        addTodo(newTodo.value);
        newTodo.value='';
      }
    });
    clearCompletedBtn.addEventListener('click', clearCompleted);
    $$('.filters button').forEach(b=> b.addEventListener('click', ()=> setFilter(b.dataset.filter)));

    // 초기 렌더
    render();
  </script>
</body>
</html>
